<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UPSC Journey Tracker</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            background: white;
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            text-align: center;
            position: relative;
        }

        .settings-icon {
            position: absolute;
            top: 20px;
            right: 30px;
            font-size: 30px;
            cursor: pointer;
            color: #667eea;
            transition: all 0.3s;
        }

        .settings-icon:hover {
            transform: rotate(90deg);
            color: #764ba2;
        }

        h1 {
            color: #667eea;
            font-size: 2.5em;
            margin: 10px 0;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .date-display {
            color: #666;
            font-size: 1.1em;
            margin-top: 10px;
        }

        .section {
            background: white;
            padding: 30px;
            border-radius: 20px;
            margin-bottom: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            animation: fadeIn 0.5s;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        h2 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 1.8em;
            border-bottom: 3px solid #667eea;
            padding-bottom: 10px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea, #764ba2);
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            color: white;
            transition: transform 0.3s;
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            animation: pulse 3s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 0.5; }
            50% { transform: scale(1.2); opacity: 0.8; }
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0,0,0,0.3);
        }

        .stat-value {
            font-size: 2.5em;
            font-weight: bold;
            margin: 10px 0;
            position: relative;
            z-index: 1;
        }

        .stat-label {
            font-size: 1.1em;
            opacity: 0.9;
            position: relative;
            z-index: 1;
        }

        .target-indicator {
            font-size: 0.9em;
            margin-top: 5px;
            opacity: 0.8;
        }

        input, textarea, select {
            width: 100%;
            padding: 12px;
            margin: 8px 0;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 14px;
            transition: all 0.3s;
        }

        input:focus, textarea:focus, select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        button {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s;
            margin: 5px;
            font-weight: 600;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
        }

        button:active {
            transform: translateY(0);
        }

        .delete-btn, .edit-btn {
            background: #ff4757;
            padding: 8px 16px;
            font-size: 14px;
        }

        .edit-btn {
            background: #ffa502;
        }

        .delete-btn:hover {
            background: #ee5a6f;
        }

        .edit-btn:hover {
            background: #ff7f00;
        }

        .timer-display {
            font-size: 5em;
            text-align: center;
            color: #667eea;
            margin: 30px 0;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }

        .timer-controls {
            text-align: center;
            margin: 20px 0;
        }

        .study-log {
            background: #f9f9f9;
            padding: 15px;
            margin: 10px 0;
            border-radius: 10px;
            border-left: 5px solid #667eea;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s;
        }

        .study-log:hover {
            background: #f0f0f0;
            transform: translateX(5px);
        }

        .routine-item {
            display: flex;
            align-items: center;
            padding: 15px;
            background: #f9f9f9;
            margin: 10px 0;
            border-radius: 10px;
            gap: 15px;
            transition: all 0.3s;
        }

        .routine-item:hover {
            background: #f0f0f0;
        }

        .routine-item input[type="checkbox"] {
            width: 24px;
            height: 24px;
            cursor: pointer;
            accent-color: #667eea;
        }

        .countdown-card {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 25px;
            border-radius: 15px;
            margin: 15px 0;
            text-align: center;
            box-shadow: 0 8px 20px rgba(0,0,0,0.2);
            transition: transform 0.3s;
        }

        .countdown-card:hover {
            transform: scale(1.02);
        }

        .countdown-number {
            font-size: 4em;
            font-weight: bold;
            margin: 15px 0;
        }

        .countdown-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }

        .progress-bar {
            width: 100%;
            height: 35px;
            background: #e0e0e0;
            border-radius: 20px;
            overflow: hidden;
            margin: 15px 0;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            transition: width 0.5s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 16px;
        }

        .todo-item {
            display: flex;
            align-items: center;
            padding: 15px;
            background: #f9f9f9;
            margin: 10px 0;
            border-radius: 10px;
            gap: 15px;
            transition: all 0.3s;
        }

        .todo-item:hover {
            background: #f0f0f0;
        }

        .todo-item input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
            accent-color: #667eea;
        }

        .journal-entry {
            background: #f9f9f9;
            padding: 20px;
            margin: 15px 0;
            border-radius: 12px;
            border-left: 5px solid #667eea;
            transition: all 0.3s;
        }

        .journal-entry:hover {
            transform: translateX(5px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .date-header {
            color: #667eea;
            font-weight: bold;
            margin-bottom: 10px;
            font-size: 1.1em;
        }

        .glass-counter {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            margin: 20px 0;
            justify-content: center;
        }

        .glass {
            width: 50px;
            height: 70px;
            background: #e0e0e0;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        .glass.filled {
            background: linear-gradient(180deg, #667eea, #4fc3f7);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        .glass:hover {
            transform: scale(1.15) rotate(5deg);
        }

        .heatmap-container {
            margin: 30px 0;
        }

        .heatmap-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 8px;
            margin: 20px 0;
        }

        .heatmap-day {
            aspect-ratio: 1;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            color: white;
            font-weight: bold;
        }

        .heatmap-day:hover {
            transform: scale(1.1);
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }

        .heatmap-level-0 { background: #ebedf0; color: #666; }
        .heatmap-level-1 { background: #c6e48b; }
        .heatmap-level-2 { background: #7bc96f; }
        .heatmap-level-3 { background: #239a3b; }
        .heatmap-level-4 { background: #196127; }

        .heatmap-legend {
            display: flex;
            gap: 10px;
            align-items: center;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .legend-box {
            width: 20px;
            height: 20px;
            border-radius: 4px;
        }

        .streak-display {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            margin: 20px 0;
            box-shadow: 0 8px 20px rgba(0,0,0,0.2);
        }

        .streak-number {
            font-size: 3em;
            font-weight: bold;
            margin: 10px 0;
        }

        .performance-badge {
            display: inline-block;
            padding: 10px 20px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 1.2em;
            margin: 10px 0;
        }

        .badge-excellent { background: #10ac84; color: white; }
        .badge-good { background: #48dbfb; color: white; }
        .badge-average { background: #feca57; color: #333; }
        .badge-poor { background: #ff6b6b; color: white; }

        .input-group {
            display: flex;
            gap: 10px;
            margin: 10px 0;
            flex-wrap: wrap;
        }

        .input-group input, .input-group select {
            flex: 1;
            min-width: 150px;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            animation: fadeIn 0.3s;
            overflow-y: auto;
        }

        .modal-content {
            background: white;
            margin: 50px auto;
            padding: 30px;
            border-radius: 20px;
            max-width: 600px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            animation: slideUp 0.3s;
            max-height: 80vh;
            overflow-y: auto;
        }

        @keyframes slideUp {
            from { transform: translateY(50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .close {
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            color: #999;
        }

        .close:hover {
            color: #333;
        }

        .weekday-labels {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 8px;
            margin-bottom: 10px;
            text-align: center;
            font-weight: bold;
            color: #667eea;
        }

        .settings-section {
            margin: 20px 0;
            padding: 20px;
            background: #f9f9f9;
            border-radius: 10px;
        }

        .settings-section h3 {
            color: #667eea;
            margin-bottom: 15px;
        }

        .subject-list-item, .routine-list-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            background: white;
            margin: 5px 0;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="settings-icon" onclick="openSettings()">⚙️</div>
            <h1 id="journeyTitle">Jitendra - UPSC Journey</h1>
            <div class="date-display" id="currentDate"></div>
        </div>

        <!-- Important Events Countdown -->
        <div class="section">
            <h2>🎯 Important Events Countdown</h2>
            <div class="countdown-grid" id="eventDashboard"></div>
        </div>

        <!-- Study Timer -->
        <div class="section">
            <h2>⏱️ Study Timer</h2>
            <div class="timer-display" id="timerDisplay">00:00:00</div>
            
            <div class="input-group" style="justify-content: center;">
                <select id="subjectSelect" style="max-width: 300px;">
                    <option value="">Select Subject</option>
                </select>
            </div>
            
            <div class="timer-controls">
                <button onclick="startTimer()" id="startBtn">▶ Start</button>
                <button onclick="pauseTimer()" id="pauseBtn">⏸ Pause</button>
                <button onclick="stopTimer()" id="stopBtn">⏹ Stop & Save</button>
            </div>

            <h3 style="color: #667eea; margin-top: 30px;">Today's Study Sessions</h3>
            <div id="studyLog"></div>

            <h3 style="color: #667eea; margin-top: 30px;">Subject-wise Total Study Time</h3>
            <div id="subjectTotals"></div>
        </div>

        <!-- Today's Dashboard -->
        <div class="section">
            <h2>📊 Today's Productivity Dashboard</h2>
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value" id="todayStudyTime">0h 0m</div>
                    <div class="stat-label">Study Time</div>
                    <div class="target-indicator">Target: 8 hours</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="todaySleep">0h</div>
                    <div class="stat-label">Sleep</div>
                    <div class="target-indicator">Target: 8 hours</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="todayWater">0</div>
                    <div class="stat-label">Water (Glasses)</div>
                    <div class="target-indicator">Target: 8 glasses</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="routineCompletion">0%</div>
                    <div class="stat-label">Routine Completed</div>
                    <div class="target-indicator">Target: 100%</div>
                </div>
            </div>
        </div>

        <!-- Routine Tracker -->
        <div class="section">
            <h2>📋 Daily Routine Tracker</h2>
            <div id="routineList"></div>
        </div>

        <!-- To-Do List -->
        <div class="section">
            <h2>✅ Today's To-Do List</h2>
            <div id="todoDashboard"></div>
        </div>

        <!-- Health Tracker -->
        <div class="section">
            <h2>💪 Health Tracker</h2>
            
            <h3 style="color: #667eea;">Sleep Tracker</h3>
            <div class="input-group">
                <input type="number" id="sleepHours" min="0" max="24" step="0.5" placeholder="Hours of sleep" style="max-width: 200px;">
                <button onclick="saveSleep()">💤 Save Sleep</button>
            </div>

            <h3 style="color: #667eea; margin-top: 30px;">Water Intake</h3>
            <p style="margin: 10px 0; color: #666; text-align: center;">Click glasses to track your water intake</p>
            <div class="glass-counter" id="waterGlasses"></div>
            <p style="text-align: center; font-size: 1.2em; color: #667eea;"><strong>Today: <span id="waterCount">0</span> / 8 glasses</strong></p>
        </div>

        <!-- Syllabus Progress -->
        <div class="section">
            <h2>📚 Syllabus Progress Overview</h2>
            <div id="syllabusDashboard"></div>
        </div>

        <!-- Daily Journal -->
        <div class="section">
            <h2>📝 Daily Journal</h2>
            <textarea id="journalText" rows="8" placeholder="Write about your day, your learnings, challenges, and achievements..."></textarea>
            <button onclick="saveJournal()">💾 Save Entry</button>

            <h3 style="color: #667eea; margin-top: 30px;">Previous Entries</h3>
            <div id="journalEntries"></div>
        </div>

        <!-- Monthly Overview -->
        <div class="section">
            <h2>📅 Monthly Overview</h2>
            
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value" id="monthlyTotalHours">0h</div>
                    <div class="stat-label">Total Study Hours</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="monthlyAverage">0h</div>
                    <div class="stat-label">Average per Day</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="monthlyAttendance">0</div>
                    <div class="stat-label">Days Studied</div>
                </div>
            </div>

            <div class="streak-display">
                <div>🔥 Current Streak</div>
                <div class="streak-number" id="streakCount">0</div>
                <div>consecutive days</div>
            </div>

            <div style="text-align: center; margin: 20px 0;">
                <div id="performanceBadge"></div>
            </div>

            <div class="heatmap-container">
                <h3 style="color: #667eea; margin-bottom: 15px;">Study Heatmap - Current Month</h3>
                <div class="weekday-labels">
                    <div>Sun</div>
                    <div>Mon</div>
                    <div>Tue</div>
                    <div>Wed</div>
                    <div>Thu</div>
                    <div>Fri</div>
                    <div>Sat</div>
                </div>
                <div class="heatmap-grid" id="heatmapGrid"></div>
                <div class="heatmap-legend">
                    <span>Less</span>
                    <div class="legend-item">
                        <div class="legend-box heatmap-level-0"></div>
                        <span>0h</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-box heatmap-level-1"></div>
                        <span>1-3h</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-box heatmap-level-2"></div>
                        <span>4-6h</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-box heatmap-level-3"></div>
                        <span>7-9h</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-box heatmap-level-4"></div>
                        <span>10h+</span>
                    </div>
                    <span>More</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div id="settingsModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeSettings()">&times;</span>
            <h2 style="color: #667eea;">⚙️ Settings</h2>

            <!-- Profile Settings -->
            <div class="settings-section">
                <h3>👤 Profile Settings</h3>
                <input type="text" id="settingsJourneyTitle" placeholder="e.g., Jitendra - UPSC Journey">
                <button onclick="saveProfile()">💾 Save Profile</button>
            </div>

            <!-- Subject Management -->
            <div class="settings-section">
                <h3>📚 Manage Subjects</h3>
                <div class="input-group">
                    <input type="text" id="newSubject" placeholder="Add new subject">
                    <button onclick="addSubject()">➕ Add</button>
                </div>
                <div id="subjectList"></div>
            </div>

            <!-- Event Management -->
            <div class="settings-section">
                <h3>🎯 Manage Events</h3>
                <div class="input-group">
                    <input type="text" id="eventName" placeholder="Event name">
                    <input type="date" id="eventDate">
                    <button onclick="addEvent()">➕ Add Event</button>
                </div>
                <div id="eventList"></div>
            </div>

            <!-- Routine Management -->
            <div class="settings-section">
                <h3>📋 Manage Routine</h3>
                <div class="input-group">
                    <input type="time" id="routineTime">
                    <input type="text" id="routineActivity" placeholder="Activity">
                    <button onclick="addRoutineItem()">➕ Add</button>
                </div>
                <div id="routineManagement"></div>
            </div>

            <!-- To-Do Management -->
            <div class="settings-section">
                <h3>✅ Manage To-Do List</h3>
                <div class="input-group">
                    <input type="text" id="todoInput" placeholder="Add a task...">
                    <button onclick="addTodo()">➕ Add Task</button>
                </div>
                <div id="todoManagement"></div>
            </div>

            <!-- Syllabus Management -->
            <div class="settings-section">
                <h3>📚 Manage Syllabus</h3>
                <div class="input-group">
                    <input type="text" id="syllabusSubject" placeholder="Subject">
                    <input type="text" id="syllabusTopic" placeholder="Topic">
                    <input type="number" id="syllabusTotal" placeholder="Total units" min="1">
                    <button onclick="addSyllabusTopic()">➕ Add Topic</button>
                </div>
                <div id="syllabusManagement"></div>
            </div>
        </div>
    </div>

    <!-- Edit Study Session Modal -->
    <div id="editModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeEditModal()">&times;</span>
            <h2 style="color: #667eea;">✏️ Edit Study Session</h2>
            <select id="editSubject"></select>
            <input type="number" id="editHours" placeholder="Hours" min="0">
            <input type="number" id="editMinutes" placeholder="Minutes" min="0" max="59">
            <button onclick="saveEdit()">💾 Save Changes</button>
        </div>
    </div>

    <script>
        let data = {
            profile: {
                journeyTitle: 'Jitendra - UPSC Journey'
            },
            subjects: ['History', 'Geography', 'Polity', 'Economics', 'Ethics', 'CSAT'],
            studySessions: [],
            journals: [],
            routine: [],
            todos: [],
            events: [],
            syllabus: [],
            health: {
                sleep: {},
                water: {},
                routine: {}
            }
        };

        let timerInterval = null;
        let timerSeconds = 0;
        let timerRunning = false;
        let editingSessionIndex = -1;

        function loadData() {
            const saved = localStorage.getItem('upscTrackerData');
            if (saved) {
                try {
                    data = JSON.parse(saved);
                    if (!data.profile) {
                        data.profile = { journeyTitle: 'Jitendra - UPSC Journey' };
                    }
                    if (!data.health) {
                        data.health = { sleep: {}, water: {}, routine: {} };
                    }
                } catch (e) {
                    console.error('Error loading data:', e);
                }
            }
            initializeApp();
        }

        function saveData() {
            try {
                localStorage.setItem('upscTrackerData', JSON.stringify(data));
            } catch (e) {
                console.error('Error saving data:', e);
                alert('Error saving data. Please check browser storage.');
            }
        }

        function initializeApp() {
            updateProfile();
            updateCurrentDate();
            updateSubjectSelect();
            updateDashboard();
            updateStudyLog();
            updateJournalEntries();
            updateRoutineList();
            updateTodoDashboard();
            updateEventDashboard();
            updateSyllabusDashboard();
            updateWaterGlasses();
            loadTodaySleep();
            updateMonthlyOverview();
        }

        function updateProfile() {
            document.getElementById('journeyTitle').textContent = data.profile.journeyTitle;
        }

        function updateCurrentDate() {
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById('currentDate').textContent = new Date().toLocaleDateString('en-US', options);
        }

        // Settings Functions
        function openSettings() {
            document.getElementById('settingsJourneyTitle').value = data.profile.journeyTitle;
            updateSubjectListSettings();
            updateEventListSettings();
            updateRoutineManagement();
            updateTodoManagement();
            updateSyllabusManagement();
            document.getElementById('settingsModal').style.display = 'block';
        }

        function closeSettings() {
            document.getElementById('settingsModal').style.display = 'none';
        }

        function saveProfile() {
            data.profile.journeyTitle = document.getElementById('settingsJourneyTitle').value || 'Jitendra - UPSC Journey';
            saveData();
            updateProfile();
            alert('Profile updated successfully!');
        }

        // Timer Functions
        function startTimer() {
            const subject = document.getElementById('subjectSelect').value;
            if (!timerRunning && subject) {
                timerRunning = true;
                document.getElementById('startBtn').disabled = true;
                timerInterval = setInterval(() => {
                    timerSeconds++;
                    updateTimerDisplay();
                }, 1000);
            } else if (!subject) {
                alert('Please select a subject first!');
            }
        }

        function pauseTimer() {
            timerRunning = false;
            clearInterval(timerInterval);
            document.getElementById('startBtn').disabled = false;
        }

        function stopTimer() {
            if (timerSeconds > 0) {
                const subject = document.getElementById('subjectSelect').value;
                if (subject) {
                    const session = {
                        subject: subject,
                        duration: timerSeconds,
                        date: new Date().toISOString()
                    };
                    data.studySessions.push(session);
                    saveData();
                    updateStudyLog();
                    updateDashboard();
                    updateMonthlyOverview();
                }
            }
            pauseTimer();
            timerSeconds = 0;
            updateTimerDisplay();
            document.getElementById('startBtn').disabled = false;
        }

        function updateTimerDisplay() {
            const hours = Math.floor(timerSeconds / 3600);
            const minutes = Math.floor((timerSeconds % 3600) / 60);
            const seconds = timerSeconds % 60;
            document.getElementById('timerDisplay').textContent = 
                `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
        }

        // Subject Management
        function addSubject() {
            const newSubject = document.getElementById('newSubject').value.trim();
            if (newSubject && !data.subjects.includes(newSubject)) {
                data.subjects.push(newSubject);
                saveData();
                updateSubjectSelect();
                updateSubjectListSettings();
                document.getElementById('newSubject').value = '';
            }
        }

        function deleteSubject(index) {
            if (confirm('Are you sure you want to delete this subject?')) {
                data.subjects.splice(index, 1);
                saveData();
                updateSubjectSelect();
                updateSubjectListSettings();
            }
        }

        function updateSubjectSelect() {
            const select = document.getElementById('subjectSelect');
            const editSelect = document.getElementById('editSubject');
            select.innerHTML = '<option value="">Select Subject</option>';
            editSelect.innerHTML = '';
            
            data.subjects.forEach(subject => {
                const option = document.createElement('option');
                option.value = subject;
                option.textContent = subject;
                select.appendChild(option);
                editSelect.appendChild(option.cloneNode(true));
            });
        }

        function updateSubjectListSettings() {
            const container = document.getElementById('subjectList');
            container.innerHTML = '';
            data.subjects.forEach((subject, index) => {
                const div = document.createElement('div');
                div.className = 'subject-list-item';
                div.innerHTML = `
                    <span>${subject}</span>
                    <button class="delete-btn" onclick="deleteSubject(${index})">🗑️ Delete</button>
                `;
                container.appendChild(div);
            });
        }

        // Study Log Functions
        function updateStudyLog() {
            const today = new Date().toDateString();
            const todaySessions = data.studySessions.filter(s => 
                new Date(s.date).toDateString() === today
            );
            
            const logDiv = document.getElementById('studyLog');
            logDiv.innerHTML = '';
            
            if (todaySessions.length === 0) {
                logDiv.innerHTML = '<p style="color: #999; text-align: center; padding: 20px;">No study sessions recorded today. Start your timer!</p>';
            } else {
                todaySessions.forEach((session) => {
                    const actualIndex = data.studySessions.indexOf(session);
                    const div = document.createElement('div');
                    div.className = 'study-log';
                    const hours = Math.floor(session.duration / 3600);
                    const minutes = Math.floor((session.duration % 3600) / 60);
                    const time = new Date(session.date).toLocaleTimeString();
                    div.innerHTML = `
                        <div>
                            <strong>${session.subject}</strong>: ${hours}h ${minutes}m
                            <span style="color: #999; margin-left: 15px;">${time}</span>
                        </div>
                        <div>
                            <button class="edit-btn" onclick="editSession(${actualIndex})">✏️ Edit</button>
                            <button class="delete-btn" onclick="deleteSession(${actualIndex})">🗑️ Delete</button>
                        </div>
                    `;
                    logDiv.appendChild(div);
                });
            }

            // Update subject totals
            const totalsDiv = document.getElementById('subjectTotals');
            totalsDiv.innerHTML = '';
            const subjectTotals = {};
            
            data.studySessions.forEach(session => {
                if (!subjectTotals[session.subject]) {
                    subjectTotals[session.subject] = 0;
                }
                subjectTotals[session.subject] += session.duration;
            });

            if (Object.keys(subjectTotals).length === 0) {
                totalsDiv.innerHTML = '<p style="color: #999; text-align: center; padding: 20px;">No study sessions recorded yet.</p>';
            } else {
                Object.entries(subjectTotals).forEach(([subject, total]) => {
                    const div = document.createElement('div');
                    div.className = 'study-log';
                    const hours = Math.floor(total / 3600);
                    const minutes = Math.floor((total % 3600) / 60);
                    div.innerHTML = `<strong>${subject}</strong>: ${hours}h ${minutes}m total`;
                    totalsDiv.appendChild(div);
                });
            }
        }

        function editSession(index) {
            editingSessionIndex = index;
            const session = data.studySessions[index];
            const hours = Math.floor(session.duration / 3600);
            const minutes = Math.floor((session.duration % 3600) / 60);
            
            document.getElementById('editSubject').value = session.subject;
            document.getElementById('editHours').value = hours;
            document.getElementById('editMinutes').value = minutes;
            document.getElementById('editModal').style.display = 'block';
        }

        function closeEditModal() {
            document.getElementById('editModal').style.display = 'none';
            editingSessionIndex = -1;
        }

        function saveEdit() {
            if (editingSessionIndex >= 0) {
                const subject = document.getElementById('editSubject').value;
                const hours = parseInt(document.getElementById('editHours').value) || 0;
                const minutes = parseInt(document.getElementById('editMinutes').value) || 0;
                
                data.studySessions[editingSessionIndex].subject = subject;
                data.studySessions[editingSessionIndex].duration = (hours * 3600) + (minutes * 60);
                
                saveData();
                updateStudyLog();
                updateDashboard();
                updateMonthlyOverview();
                closeEditModal();
            }
        }

        function deleteSession(index) {
            if (confirm('Are you sure you want to delete this study session?')) {
                data.studySessions.splice(index, 1);
                saveData();
                updateStudyLog();
                updateDashboard();
                updateMonthlyOverview();
            }
        }

        // Journal Functions
        function saveJournal() {
            const text = document.getElementById('journalText').value.trim();
            if (text) {
                const entry = {
                    text: text,
                    date: new Date().toISOString()
                };
                data.journals.push(entry);
                saveData();
                document.getElementById('journalText').value = '';
                updateJournalEntries();
                alert('Journal entry saved!');
            }
        }

        function updateJournalEntries() {
            const container = document.getElementById('journalEntries');
            container.innerHTML = '';
            
            if (data.journals.length === 0) {
                container.innerHTML = '<p style="color: #999; text-align: center; padding: 20px;">No journal entries yet.</p>';
            } else {
                data.journals.slice().reverse().forEach((entry, index) => {
                    const actualIndex = data.journals.length - 1 - index;
                    const div = document.createElement('div');
                    div.className = 'journal-entry';
                    div.innerHTML = `
                        <div class="date-header">${new Date(entry.date).toLocaleString()}</div>
                        <p>${entry.text}</p>
                        <button class="delete-btn" onclick="deleteJournal(${actualIndex})">🗑️ Delete</button>
                    `;
                    container.appendChild(div);
                });
            }
        }

        function deleteJournal(index) {
            if (confirm('Are you sure you want to delete this journal entry?')) {
                data.journals.splice(index, 1);
                saveData();
                updateJournalEntries();
            }
        }

        // Routine Functions
        function addRoutineItem() {
            const time = document.getElementById('routineTime').value;
            const activity = document.getElementById('routineActivity').value.trim();
            
            if (time && activity) {
                data.routine.push({ time, activity });
                data.routine.sort((a, b) => a.time.localeCompare(b.time));
                saveData();
                updateRoutineList();
                updateRoutineManagement();
                document.getElementById('routineTime').value = '';
                document.getElementById('routineActivity').value = '';
            }
        }

        function updateRoutineList() {
            const today = new Date().toDateString();
            if (!data.health.routine[today]) {
                data.health.routine[today] = {};
            }
            
            const container = document.getElementById('routineList');
            container.innerHTML = '';
            
            if (data.routine.length === 0) {
                container.innerHTML = '<p style="color: #999; text-align: center; padding: 20px;">No routine items set. Add them in Settings!</p>';
            } else {
                data.routine.forEach((item, index) => {
                    const div = document.createElement('div');
                    div.className = 'routine-item';
                    const checked = data.health.routine[today][index] || false;
                    div.innerHTML = `
                        <input type="checkbox" ${checked ? 'checked' : ''} onchange="toggleRoutine(${index})">
                        <strong>${item.time}</strong> - ${item.activity}
                    `;
                    container.appendChild(div);
                });
            }
            
            updateDashboard();
        }

        function updateRoutineManagement() {
            const container = document.getElementById('routineManagement');
            container.innerHTML = '';
            
            data.routine.forEach((item, index) => {
                const div = document.createElement('div');
                div.className = 'routine-list-item';
                div.innerHTML = `
                    <span><strong>${item.time}</strong> - ${item.activity}</span>
                    <button class="delete-btn" onclick="deleteRoutine(${index})">🗑️ Delete</button>
                `;
                container.appendChild(div);
            });
        }

        function toggleRoutine(index) {
            const today = new Date().toDateString();
            if (!data.health.routine[today]) {
                data.health.routine[today] = {};
            }
            data.health.routine[today][index] = !data.health.routine[today][index];
            saveData();
            updateRoutineList();
        }

        function deleteRoutine(index) {
            if (confirm('Are you sure you want to delete this routine item?')) {
                data.routine.splice(index, 1);
                saveData();
                updateRoutineList();
                updateRoutineManagement();
            }
        }

        // To-Do Functions
        function addTodo() {
            const text = document.getElementById('todoInput').value.trim();
            if (text) {
                const today = new Date().toDateString();
                const todo = {
                    text: text,
                    date: today,
                    done: false
                };
                data.todos.push(todo);
                saveData();
                document.getElementById('todoInput').value = '';
                updateTodoDashboard();
                updateTodoManagement();
            }
        }

        function updateTodoDashboard() {
            const today = new Date().toDateString();
            const todayTodos = data.todos.filter(t => t.date === today);
            
            const container = document.getElementById('todoDashboard');
            container.innerHTML = '';
            
            if (todayTodos.length === 0) {
                container.innerHTML = '<p style="color: #999; text-align: center; padding: 20px;">No tasks for today. Add them in Settings!</p>';
            } else {
                todayTodos.forEach((todo) => {
                    const actualIndex = data.todos.indexOf(todo);
                    const div = document.createElement('div');
                    div.className = 'todo-item';
                    div.innerHTML = `
                        <input type="checkbox" ${todo.done ? 'checked' : ''} onchange="toggleTodo(${actualIndex})">
                        <span style="flex: 1; ${todo.done ? 'text-decoration: line-through; opacity: 0.6;' : ''}">${todo.text}</span>
                    `;
                    container.appendChild(div);
                });
            }
        }

        function updateTodoManagement() {
            const today = new Date().toDateString();
            const todayTodos = data.todos.filter(t => t.date === today);
            
            const container = document.getElementById('todoManagement');
            container.innerHTML = '';
            
            todayTodos.forEach((todo) => {
                const actualIndex = data.todos.indexOf(todo);
                const div = document.createElement('div');
                div.className = 'todo-item';
                div.innerHTML = `
                    <input type="checkbox" ${todo.done ? 'checked' : ''} onchange="toggleTodo(${actualIndex})">
                    <span style="flex: 1; ${todo.done ? 'text-decoration: line-through; opacity: 0.6;' : ''}">${todo.text}</span>
                    <button class="delete-btn" onclick="deleteTodo(${actualIndex})">🗑️</button>
                `;
                container.appendChild(div);
            });
        }

        function toggleTodo(index) {
            data.todos[index].done = !data.todos[index].done;
            saveData();
            updateTodoDashboard();
            updateTodoManagement();
        }

        function deleteTodo(index) {
            if (confirm('Are you sure you want to delete this task?')) {
                data.todos.splice(index, 1);
                saveData();
                updateTodoDashboard();
                updateTodoManagement();
            }
        }

        // Health Functions
        function saveSleep() {
            const hours = parseFloat(document.getElementById('sleepHours').value);
            if (hours >= 0) {
                const today = new Date().toDateString();
                data.health.sleep[today] = hours;
                saveData();
                updateDashboard();
                alert('Sleep recorded successfully!');
            }
        }

        function loadTodaySleep() {
            const today = new Date().toDateString();
            const sleep = data.health.sleep[today] || 0;
            document.getElementById('sleepHours').value = sleep || '';
        }

        function updateWaterGlasses() {
            const today = new Date().toDateString();
            const count = data.health.water[today] || 0;
            
            const container = document.getElementById('waterGlasses');
            container.innerHTML = '';
            
            for (let i = 0; i < 8; i++) {
                const glass = document.createElement('div');
                glass.className = 'glass' + (i < count ? ' filled' : '');
                glass.onclick = () => setWaterCount(i + 1);
                container.appendChild(glass);
            }
            
            document.getElementById('waterCount').textContent = count;
            updateDashboard();
        }

        function setWaterCount(count) {
            const today = new Date().toDateString();
            data.health.water[today] = count;
            saveData();
            updateWaterGlasses();
        }

        // Event Functions
        function addEvent() {
            const name = document.getElementById('eventName').value.trim();
            const date = document.getElementById('eventDate').value;
            
            if (name && date) {
                data.events.push({ name, date });
                saveData();
                updateEventDashboard();
                updateEventListSettings();
                document.getElementById('eventName').value = '';
                document.getElementById('eventDate').value = '';
            }
        }

        function updateEventDashboard() {
            const container = document.getElementById('eventDashboard');
            container.innerHTML = '';
            
            if (data.events.length === 0) {
                container.innerHTML = '<p style="color: #999; text-align: center; padding: 20px;">No events scheduled. Add them in Settings!</p>';
            } else {
                data.events.forEach((event) => {
                    const eventDate = new Date(event.date);
                    const today = new Date();
                    today.setHours(0, 0, 0, 0);
                    const diffTime = eventDate - today;
                    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                    
                    const div = document.createElement('div');
                    div.className = 'countdown-card';
                    div.innerHTML = `
                        <h3>${event.name}</h3>
                        <div class="countdown-number">${diffDays}</div>
                        <p>days ${diffDays >= 0 ? 'remaining' : 'overdue'}</p>
                    `;
                    container.appendChild(div);
                });
            }
        }

        function updateEventListSettings() {
            const container = document.getElementById('eventList');
            container.innerHTML = '';
            
            data.events.forEach((event, index) => {
                const div = document.createElement('div');
                div.className = 'routine-list-item';
                div.innerHTML = `
                    <span><strong>${event.name}</strong> - ${event.date}</span>
                    <button class="delete-btn" onclick="deleteEvent(${index})">🗑️ Delete</button>
                `;
                container.appendChild(div);
            });
        }

        function deleteEvent(index) {
            if (confirm('Are you sure you want to delete this event?')) {
                data.events.splice(index, 1);
                saveData();
                updateEventDashboard();
                updateEventListSettings();
            }
        }

        // Syllabus Functions
        function addSyllabusTopic() {
            const subject = document.getElementById('syllabusSubject').value.trim();
            const topic = document.getElementById('syllabusTopic').value.trim();
            const total = parseInt(document.getElementById('syllabusTotal').value);
            
            if (subject && topic && total > 0) {
                data.syllabus.push({ subject, topic, total, completed: 0 });
                saveData();
                updateSyllabusDashboard();
                updateSyllabusManagement();
                document.getElementById('syllabusSubject').value = '';
                document.getElementById('syllabusTopic').value = '';
                document.getElementById('syllabusTotal').value = '';
            }
        }

        function updateSyllabusDashboard() {
            const container = document.getElementById('syllabusDashboard');
            container.innerHTML = '';
            
            if (data.syllabus.length === 0) {
                container.innerHTML = '<p style="color: #999; text-align: center; padding: 20px;">No syllabus topics added. Add them in Settings!</p>';
            } else {
                data.syllabus.forEach((item) => {
                    const percentage = Math.round((item.completed / item.total) * 100);
                    const div = document.createElement('div');
                    div.style.marginBottom = '20px';
                    div.innerHTML = `
                        <h3 style="color: #667eea;">${item.subject} - ${item.topic}</h3>
                        <p style="color: #666;">Progress: ${item.completed} / ${item.total} units</p>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${percentage}%">${percentage}%</div>
                        </div>
                    `;
                    container.appendChild(div);
                });
            }
        }

        function updateSyllabusManagement() {
            const container = document.getElementById('syllabusManagement');
            container.innerHTML = '';
            
            data.syllabus.forEach((item, index) => {
                const percentage = Math.round((item.completed / item.total) * 100);
                const div = document.createElement('div');
                div.style.marginBottom = '20px';
                div.style.padding = '15px';
                div.style.background = 'white';
                div.style.borderRadius = '10px';
                div.innerHTML = `
                    <h4 style="color: #667eea;">${item.subject} - ${item.topic}</h4>
                    <p>Progress: ${item.completed} / ${item.total} units</p>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: ${percentage}%">${percentage}%</div>
                    </div>
                    <div style="margin-top: 10px;">
                        <button onclick="updateProgress(${index}, 1)">+1 Unit</button>
                        <button onclick="updateProgress(${index}, -1)">-1 Unit</button>
                        <button class="delete-btn" onclick="deleteSyllabus(${index})">🗑️ Delete</button>
                    </div>
                `;
                container.appendChild(div);
            });
        }

        function updateProgress(index, change) {
            data.syllabus[index].completed = Math.max(0, Math.min(data.syllabus[index].total, data.syllabus[index].completed + change));
            saveData();
            updateSyllabusDashboard();
            updateSyllabusManagement();
        }

        function deleteSyllabus(index) {
            if (confirm('Are you sure you want to delete this syllabus topic?')) {
                data.syllabus.splice(index, 1);
                saveData();
                updateSyllabusDashboard();
                updateSyllabusManagement();
            }
        }

        // Dashboard Update
        function updateDashboard() {
            const today = new Date().toDateString();
            
            // Study time
            const todaySessions = data.studySessions.filter(s => 
                new Date(s.date).toDateString() === today
            );
            const totalSeconds = todaySessions.reduce((sum, s) => sum + s.duration, 0);
            const hours = Math.floor(totalSeconds / 3600);
            const minutes = Math.floor((totalSeconds % 3600) / 60);
            document.getElementById('todayStudyTime').textContent = `${hours}h ${minutes}m`;
            
            // Sleep
            const sleep = data.health.sleep[today] || 0;
            document.getElementById('todaySleep').textContent = `${sleep}h`;
            
            // Water
            const water = data.health.water[today] || 0;
            document.getElementById('todayWater').textContent = water;
            
            // Routine completion
            const routineToday = data.health.routine[today] || {};
            const completedCount = Object.values(routineToday).filter(v => v).length;
            const totalRoutine = data.routine.length;
            const routinePercentage = totalRoutine > 0 ? Math.round((completedCount / totalRoutine) * 100) : 0;
            document.getElementById('routineCompletion').textContent = `${routinePercentage}%`;
        }

        // Monthly Overview
        function updateMonthlyOverview() {
            const now = new Date();
            const currentMonth = now.getMonth();
            const currentYear = now.getFullYear();
            
            const monthlySessions = data.studySessions.filter(s => {
                const sessionDate = new Date(s.date);
                return sessionDate.getMonth() === currentMonth && sessionDate.getFullYear() === currentYear;
            });
            
            // Calculate total hours
            const totalSeconds = monthlySessions.reduce((sum, s) => sum + s.duration, 0);
            const totalHours = Math.floor(totalSeconds / 3600);
            document.getElementById('monthlyTotalHours').textContent = `${totalHours}h`;
            
            // Calculate days studied
            const daysStudied = new Set(monthlySessions.map(s => new Date(s.date).toDateString())).size;
            document.getElementById('monthlyAttendance').textContent = daysStudied;
            
            // Calculate average
            const avgHours = daysStudied > 0 ? Math.round(totalSeconds / 3600 / daysStudied) : 0;
            document.getElementById('monthlyAverage').textContent = `${avgHours}h`;
            
            // Performance badge
            const badge = document.getElementById('performanceBadge');
            if (avgHours >= 8) {
                badge.className = 'performance-badge badge-excellent';
                badge.textContent = '🏆 Excellent Performance!';
            } else if (avgHours >= 6) {
                badge.className = 'performance-badge badge-good';
                badge.textContent = '✨ Good Performance!';
            } else if (avgHours >= 4) {
                badge.className = 'performance-badge badge-average';
                badge.textContent = '👍 Average Performance';
            } else {
                badge.className = 'performance-badge badge-poor';
                badge.textContent = '⚠️ Needs Improvement';
            }
            
            // Calculate streak
            calculateStreak();
            
            // Update heatmap
            updateHeatmap();
        }

        function calculateStreak() {
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            let streak = 0;
            let checkDate = new Date(today);
            
            while (true) {
                const dateStr = checkDate.toDateString();
                const daySessions = data.studySessions.filter(s => 
                    new Date(s.date).toDateString() === dateStr
                );
                
                if (daySessions.length > 0) {
                    streak++;
                    checkDate.setDate(checkDate.getDate() - 1);
                } else {
                    break;
                }
            }
            
            document.getElementById('streakCount').textContent = streak;
        }

        function updateHeatmap() {
            const grid = document.getElementById('heatmapGrid');
            grid.innerHTML = '';
            
            const now = new Date();
            const firstDay = new Date(now.getFullYear(), now.getMonth(), 1);
            const lastDay = new Date(now.getFullYear(), now.getMonth() + 1, 0);
            
            // Add empty cells for days before first day of month
            const firstDayOfWeek = firstDay.getDay();
            for (let i = 0; i < firstDayOfWeek; i++) {
                const emptyDiv = document.createElement('div');
                grid.appendChild(emptyDiv);
            }
            
            // Add cells for each day of month
            for (let day = 1; day <= lastDay.getDate(); day++) {
                const date = new Date(now.getFullYear(), now.getMonth(), day);
                const dateStr = date.toDateString();
                
                const daySessions = data.studySessions.filter(s => 
                    new Date(s.date).toDateString() === dateStr
                );
                
                const totalSeconds = daySessions.reduce((sum, s) => sum + s.duration, 0);
                const hours = totalSeconds / 3600;
                
                let level = 0;
                if (hours >= 10) level = 4;
                else if (hours >= 7) level = 3;
                else if (hours >= 4) level = 2;
                else if (hours > 0) level = 1;
                
                const dayDiv = document.createElement('div');
                dayDiv.className = `heatmap-day heatmap-level-${level}`;
                dayDiv.textContent = day;
                dayDiv.title = `${dateStr}: ${Math.round(hours * 10) / 10}h`;
                grid.appendChild(dayDiv);
            }
        }

        // Close modals when clicking outside
        window.onclick = function(event) {
            if (event.target.className === 'modal') {
                event.target.style.display = 'none';
            }
        }

        // Initialize on page load
        window.onload = loadData;
    </script>
</body>
</html>
